SELECT DISTINCT FP.CLIENTE, CL.NOME, CL.FISJUR "FIS/JUR",
	case when CL.FISJUR = 'F' then PF.DTA_NASCIMENTO 
    	else Null end NASCIMENTO,
    CL.DDD_TELEFONE, CL.TELEFONE,
    CL.DDD_CELULAR, CL.CELULAR,
    (CL.TIPOVIA_ENTREGA || ' ' || CL.LOGRADOURO_ENTREGA || '-' || CL.COMPLEMENTO_ENTREGA) AS Endereco, 
	CL.BAIRRO_ENTREGA, CL.MUNICIPIO_ENTREGA, CL.UF_ENTREGA, CL.CEP_ENTREGA,
    CL.E_MAIL_CASA, CL.E_MAIL_TRABALHO, 
    VE.VEICULO, VE.NOVO_USADO, VE.MODELO, FS.ANO_FABRICACAO, FS.ANO_MODELO, VE.DTA_VENDA, FP.CHASSI, 
    VE.REVENDA_NFSAIDA, 
	 FVE.NOME VENDEDOR 
FROM OFI_FICHA_SEGUIMENTO FS 
INNER JOIN OFI_FICHA_PROPRIETARIO FP 
	ON (FS.CHASSI = FP.CHASSI) 
INNER JOIN FAT_CLIENTE CL 
	ON (FP.CLIENTE = CL.CLIENTE) 
LEFT JOIN FAT_PESSOA_FISICA PF 
	ON (PF.CLIENTE = CL.CLIENTE)
LEFT JOIN FAT_PESSOA_JURIDICA PJ 
	ON (PJ.CLIENTE = CL.CLIENTE)
INNER JOIN VEI_MODELO MO 
	ON (FS.EMPRESA = MO.EMPRESA) 
    AND (FS.MODELO = MO.MODELO) 
INNER JOIN VEI_FAMILIA FA 
	ON (MO.EMPRESA = FA.EMPRESA) 
    AND (MO.FAMILIA = FA.FAMILIA) 
INNER JOIN GER_MARCA GE 
	ON (FA.MARCA = GE.MARCA) 
LEFT JOIN VEI_VEICULO VE 
	ON (FS.CHASSI = VE.CHASSI) 
LEFT JOIN  FAT_VENDEDOR FVE
	ON (VE.VENDEDOR_VEICULO = FVE.VENDEDOR
    AND VE.REVENDA_NFSAIDA = FVE.REVENDA)
LEFT JOIN (select EMPRESA, VEICULO, max(DTA_ENTREGA_REAL) DTA_ENTREGA_REAL 
		from VEI_AGENDA_ENTREGA group by EMPRESA, VEICULO) AE 
    ON (VE.EMPRESA = AE.EMPRESA 
    and VE.VEICULO = AE.VEICULO) 
LEFT JOIN FAT_MOVIMENTO_CAPA FMC 
	ON (VE.EMPRESA_NFSAIDA = FMC.EMPRESA) 
    AND (VE.REVENDA_NFSAIDA = FMC.REVENDA) 
    AND (VE.NUMERO_NOTA_NFSAIDA = FMC.NUMERO_NOTA_FISCAL) 
    AND (VE.SERIE_NOTA_FISCAL_NFSAIDA = FMC.SERIE_NOTA_FISCAL ) 
    AND (VE.TIPO_TRANSACAO_NFSAIDA = FMC.TIPO_TRANSACAO ) 
    AND (VE.CONTADOR_NFSAIDA = FMC.CONTADOR) 
WHERE FP.PROPRIETARIO_ATUAL = 'S' 
	AND FS.EMPRESA = 1 
    and FS.REVENDA = 1 
    AND (CL.ACEITA_CONTATADO = 'S' OR CL.ACEITA_CONTATADO IS NULL) 
    AND NOT EXISTS ( select CLIENTE from FAT_CLIENTE_LGPD 
    	where EMPRESA = 1 
        	and REVENDA = 1 
            and CLIENTE = CL.CLIENTE 
            and coalesce(DIREITO_ESQUECIMENTO,'N') = 'S' ) 
    AND VE.DTA_VENDA between TO_DATE('01/12/2021','dd/mm/yyyy') 
    and TO_DATE('31/12/2021','dd/mm/yyyy') 
    ORDER BY 1